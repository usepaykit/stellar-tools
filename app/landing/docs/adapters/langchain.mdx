---
title: 'LangChain Adapter'
description: 'Meter LangChain model usage with Stellar Tools'
---

The LangChain adapter wraps a LangChain **language model** and meters usage (tokens or similar) via Stellar Tools credits. It uses [@stellartools/plugin-sdk](https://github.com/usepaykit/stellar-tools) for preflight, charge, and refund.

## Install

```bash
pnpm add langchain-adapter @stellartools/plugin-sdk @langchain/core langchain
```

## Usage

Use `createMeteredModel` with your plugin config and a base LangChain model. The returned model supports the same interface (e.g. `invoke`, `stream`, `batch`, `streamEvents`) but charges the given `customerId` for usage.

```ts
import { createMeteredModel } from "langchain-adapter";
import { ChatOpenAI } from "@langchain/openai";

const config = {
  apiKey: process.env.STELLAR_TOOLS_API_KEY!,
  productId: "prod_llm",
};

const baseModel = new ChatOpenAI({ model: "gpt-4o", temperature: 0 });
const meteredModel = createMeteredModel(config, baseModel);

// Use like any LangChain model; pass customerId in options
const result = await meteredModel.invoke(
  [{ role: "user", content: "Hello" }],
  { customerId: "cust_xxx" }
);
```

The adapter:

- Runs a **preflight** check (e.g. balance) before the call.
- **Charges** the customer based on reported usage (e.g. token count) after the call.
- On failure, can **refund** so the customer is not charged for failed requests.

Supported operations include **stream**, **batch**, and **streamEvents**; each is metered and tied to the same `customerId` in the run options.

## Config

`createMeteredModel(config, baseModel)` expects:

- **config**: `MeteredPluginConfig` from `@stellartools/plugin-sdk` (`apiKey`, `productId`, etc.).
- **baseModel**: Any LangChain `BaseLanguageModel` (e.g. `ChatOpenAI`, `ChatAnthropic`).

Ensure your Stellar Tools product is a **credit product** and that customers have sufficient balance; otherwise preflight will fail and the call will not be made.
