---
title: 'MedusaJS Adapter'
description: 'Use Stellar as a payment provider in Medusa v2'
---

The MedusaJS adapter registers Stellar as a **payment provider** in [Medusa v2](https://medusajs.com). Customers pay with Stellar (XLM or other assets); you get webhooks and full payment lifecycle.

## Install

```bash
pnpm add @stellartools/medusajs-adapter
```

## Configure

In your Medusa config, add the Stellar payment module and pass your Stellar Tools API key:

```ts
import stellarPaymentModule from "@stellartools/medusajs-adapter";

export default defineConfig({
  modules: [
    // ... your other modules
    stellarPaymentModule({
      apiKey: process.env.STELLAR_TOOLS_API_KEY!,
      debug: false, // optional
    }),
  ],
});
```

## Options

| Option | Type | Description |
|--------|------|-------------|
| `apiKey` | `string` | Your Stellar Tools API key (required). |
| `debug` | `boolean` | Enable debug logging (optional). |

## Behavior

- **Payment provider identifier**: `stellar`.
- **Initiate payment**: Creates a [direct checkout](/docs/api-reference/checkout) with `amount` and `currency_code`; returns `payment_url` for redirect.
- **Get / authorize / retrieve payment**: Uses Stellar Tools [payments API](/docs/api-reference/payments); status is mapped to Medusa session status (`REQUIRES_MORE`, `AUTHORIZED`, `ERROR`).
- **Capture**: No-op (treats as captured).
- **Refund**: Calls Stellar [refunds API](/docs/api-reference/refunds); requires `receiverPublicKey` and optional `reason` in payment data.
- **Account holder**: Create/update/delete map to Stellar [customers](/docs/api-reference/customers).
- **Webhooks**: Handles `payment.pending`, `payment.confirmed`, `payment.failed` and forwards to Medusa.

Blockchain payments are immutable: **cancel**, **delete**, and **update** payment throw `NOT_ALLOWED`.

## Webhook setup

Configure your [Stellar Tools webhook](/docs/api-reference/webhooks) to post to Medusa’s provider webhook URL. The adapter parses the payload and returns the appropriate `PaymentActions` (e.g. `SUCCESSFUL` for `payment.confirmed`).

## Example: Initiate payment

When a customer checks out, Medusa calls the provider’s `initiatePayment` with `amount`, `currency_code`, and context. The adapter creates a direct checkout and returns:

- `id`: checkout ID  
- `status`: `REQUIRES_MORE`  
- `data.payment_url`: URL for the customer to complete payment with Stellar  

Redirect the customer to `payment_url`; after payment, your webhook will receive the event and Medusa will update the order.
