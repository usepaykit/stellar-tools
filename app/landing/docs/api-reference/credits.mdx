---
title: 'Credits'
description: 'Manage customer credit balances and usage for metered billing'
---

Credits power **metered billing**: customers have a balance per metered product, and you **deduct** when they use the service, **refund** to undo a charge, or **grant** more credits. Amounts are sent in **raw units** (e.g. tokens, bytes); the API converts to credits using the product’s `unitDivisor` and `unitsPerCredit`.

All endpoints require `x-api-key`.

---

## Get credit balance

Returns the current credit balance for a customer and metered product (balance, consumed, granted).

```http GET /api/customers/:customerId/credits/:productId
GET /api/customers/cust_xxx/credits/prod_xxx
x-api-key: your_api_key
```

**Response** `200`: `{ "data": { "id", "customerId", "productId", "balance", "consumed", "granted", "metadata", "createdAt", "updatedAt", "environment", "organizationId" } }`

---

## List credit transactions

Returns the transaction history for a customer’s credits. Optionally filter by product and paginate.

```http GET /api/customers/:customerId/credits/transactions
GET /api/customers/cust_xxx/credits/transactions?productId=prod_xxx&limit=50&offset=0
x-api-key: your_api_key
```

| Query   | Type   | Default | Description                          |
|---------|--------|--------|--------------------------------------|
| productId | string | —      | Filter by metered product ID.        |
| limit  | number | 50     | Max number of transactions to return. |
| offset | number | 0      | Number of transactions to skip.      |

**Response** `200`: `{ "data": [ { "id", "customerId", "productId", "balanceId", "amount", "balanceBefore", "balanceAfter", "type", "reason", "metadata", "createdAt", ... }, ... ] }`

`type` is `"deduct"`, `"refund"`, or `"grant"`.

---

## Post credit transaction

Deduct, refund, or grant credits for a customer on a metered product. **Amount is in raw units** (e.g. tokens, bytes); the server converts to credits using the product’s `unitDivisor` and `unitsPerCredit`.

```http POST /api/customers/:customerId/credits/:productId/transaction
POST /api/customers/cust_xxx/credits/prod_xxx/transaction
x-api-key: your_api_key
Content-Type: application/json

{
  "amount": 250,
  "type": "deduct",
  "reason": "AI completion tokens",
  "metadata": { "requestId": "req_123" },
  "dryRun": false
}
```

| Body field | Type    | Required | Description |
|------------|---------|----------|-------------|
| amount    | number  | Yes      | Raw usage amount (e.g. 250 tokens). Converted to credits by the product’s conversion rules. |
| type      | string  | Yes      | `"deduct"` — charge the customer; `"refund"` — add credits back (undo); `"grant"` — add credits (e.g. top-up). |
| reason    | string  | No       | Optional description for the transaction. |
| metadata  | object  | No       | Optional key-value data. |
| dryRun    | boolean | No       | If `true`, only check sufficiency (for deduct). No balance or transaction is written. |

- **Deduct:** Fails with `Insufficient credits` if balance would go negative.
- **Refund:** Increases balance and decreases `consumed` (undoes a prior deduct).
- **Grant:** Increases balance and `granted` (e.g. purchase or admin grant).

**Response** `200`: `{ "isSufficient": true, "transaction": { "id", "amount", "balanceBefore", "balanceAfter", "type", ... }, "balance": { updated balance object } }`  
For `dryRun: true`, `transaction` is `null` and `balance` is the current balance (unchanged).

**Errors:** `400` — validation or invalid product/customer; `400` with message `Insufficient credits` when deduct would exceed balance; `400` with message `Invalid Meter Configuration` when no credit balance exists for that customer/product.
